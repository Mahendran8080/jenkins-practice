## Jenkinsfile – CI/CD Pipeline Definition

| Item | Description |
|------|-------------|
| **File** | `Jenkinsfile` |
| **Location** | Root of the repository (or `ci/Jenkinsfile` if nested) |
| **Purpose** | Defines a declarative Jenkins pipeline that checks out the source, installs dependencies, runs tests, builds a Docker image, and pushes it to Docker Hub. |

---

### 1. File Purpose

The `Jenkinsfile` is the heart of the continuous‑integration and continuous‑delivery (CI/CD) process for this Node.js application. It tells Jenkins:

1. **Where to run** – `agent any` allows the job to run on any available node.
2. **What environment variables to use** – `IMAGE_NAME` and `IMAGE_TAG` are used throughout the pipeline.
3. **The sequence of steps** – Each `stage` represents a logical step in the build lifecycle: checkout, install, test, build, and push.

---

### 2. Key Logic & Code Blocks

| Stage | Purpose | Key Commands |
|-------|---------|--------------|
| **Checkout** | Pull the latest source from the repository. | `checkout scm` |
| **Install Dependencies** | Install npm packages required for the app. | `sh 'npm install'` |
| **Test** | Run unit tests. If no tests exist, the pipeline continues gracefully. | `sh 'npm test || echo "No tests found"'` |
| **Docker Build** | Build a Docker image from the current directory. | `sh 'docker build -t $IMAGE_NAME:$IMAGE_TAG .'` |
| **Docker Push** | Authenticate with Docker Hub and push the image. | ```sh
docker login -u $DOCKER_USER -p $DOCKER_PASS
docker push $IMAGE_NAME:$IMAGE_TAG
``` |

#### Environment Variables

```groovy
environment {
    IMAGE_NAME = "mahi8081/node-jenkins-app"
    IMAGE_TAG  = "latest"
}
```

* `IMAGE_NAME` – Docker Hub repository name.
* `IMAGE_TAG` – Tag applied to the built image (default `latest`).

#### Credentials

```groovy
withCredentials([usernamePassword(
    credentialsId: 'dockerhub-creds',
    usernameVariable: 'DOCKER_USER',
    passwordVariable: 'DOCKER_PASS'
)])
```

* Uses Jenkins Credentials Binding to securely inject Docker Hub username/password into the shell script.

---

### 3. DevOps Context

| Aspect | How It Fits |
|--------|-------------|
| **CI** | The pipeline automatically runs on each commit (or PR) to ensure code compiles, tests pass, and a Docker image can be built. |
| **CD** | After a successful build, the image is pushed to Docker Hub, ready for deployment to any environment that pulls from that registry. |
| **Docker** | The pipeline builds a containerized version of the Node.js app, encapsulating all dependencies and runtime configuration. |
| **Jenkins** | Declarative syntax keeps the pipeline readable and maintainable. The `agent any` line allows the job to run on any available Jenkins executor, making it portable across agents. |
| **Security** | Credentials are stored in Jenkins and never hard‑coded, ensuring secrets remain protected. |

---

### 4. Typical Usage Flow

1. **Commit** → Jenkins triggers the pipeline.
2. **Checkout** → Source is pulled.
3. **Install** → `npm install` fetches dependencies.
4. **Test** → Runs tests; failure aborts the job.
5. **Build** → Docker image is created.
6. **Push** → Image is uploaded to Docker Hub.
7. **Deploy** → (Outside this file) downstream stages or external tools can pull the image and deploy it to Kubernetes, ECS, or any target environment.

---

### 5. Recommendations

| Item | Suggestion |
|------|------------|
| **Tagging** | Replace `latest` with a dynamic tag (e.g., Git commit SHA or build number) to avoid overwriting images. |
| **Test Fallback** | Consider removing the `|| echo "No tests found"` if tests are mandatory; otherwise, document the policy. |
| **Dockerfile** | Ensure a `.dockerignore` file exists to keep the build context lean. |
| **Pipeline Parallelism** | If the project grows, split stages into separate jobs or use `parallel` blocks for faster execution. |

---

**End of Jenkinsfile Documentation**